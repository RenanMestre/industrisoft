<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Monitoramento de M√°quinas</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-tooltip"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  </head>
  <body class="bg-gray-50 text-gray-800 p-4">
    <div class="max-w-6xl mx-auto">
      <div class="flex items-center justify-between mb-4">
        <a href="index.html"><button onclick="history.back()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded">
          ‚¨ÖÔ∏è Voltar
        </button></a>
        <select id="machine-selector" onchange="changeMachine(this.value)" class="p-2 rounded border border-gray-300">
          <option value="1">M√°quina 01 (‚úÖ)</option>
          <option value="2">M√°quina 02 (‚úÖ)</option>
          <option value="3">M√°quina 03 (‚úÖ)</option>
          <option value="4">M√°quina 04 (‚úÖ)</option>
          <option value="5">M√°quina 05 (‚úÖ)</option>
          <option value="6">M√°quina 06 (‚úÖ)</option>
          <option value="7">M√°quina 07 (‚úÖ)</option>
          <option value="8">M√°quina 08 (‚úÖ)</option>
          <option value="9">M√°quina 09 (‚úÖ)</option>
          <option value="10">M√°quina 10 (‚úÖ)</option>
          <option value="11">M√°quina 11 (‚úÖ)</option>
          <option value="12">M√°quina 12 (‚úÖ)</option>
          <option value="13">M√°quina 13 (‚ö†Ô∏è Alerta)</option>
          <option value="14">M√°quina 14 (‚ùå Falha)</option>
          <option value="15">M√°quina 15 (‚ùå Falha)</option>
        </select>
      </div>

      <h1 id="machine-title" class="text-3xl font-bold mb-4">M√ÅQUINA 01</h1>
      <div class="flex items-center mb-6" id="status-container">
        <div class="w-4 h-4 bg-green-500 rounded-full mr-2"></div>
        <span class="text-lg font-medium">Funcionando normalmente</span>
      </div>

      <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
        <div class="bg-white shadow-md rounded-xl p-4 text-center">
          <div class="text-red-600 text-xl font-bold">Temperatura</div>
          <div id="temp-value" class="text-2xl font-semibold">72¬∞C</div>
        </div>
        <div class="bg-white shadow-md rounded-xl p-4 text-center">
          <div class="text-yellow-600 text-xl font-bold">Vibra√ß√£o</div>
          <div id="vibracao-value" class="text-2xl font-semibold">3.1 mm/s</div>
        </div>
        <div class="bg-white shadow-md rounded-xl p-4 text-center">
          <div class="text-blue-600 text-xl font-bold">Press√£o</div>
          <div id="pressao-value" class="text-2xl font-semibold">5,2 bar</div>
        </div>
        <div class="bg-white shadow-md rounded-xl p-4 text-center">
          <div class="text-blue-800 text-xl font-bold">Ciclos de uso</div>
          <div id="ciclos-value" class="text-2xl font-semibold">120</div>
        </div>
        <div class="bg-white shadow-md rounded-xl p-4 text-center">
          <div class="text-blue-600 text-xl font-bold mb-2">N√≠vel de √≥leo</div>
          <div class="relative w-full h-3 bg-gray-200 rounded-full mb-2">
            <div id="oleo-bar" class="absolute top-0 left-0 h-3 bg-blue-600 rounded-full" style="width: 65%;"></div>
          </div>
          <div class="text-sm text-gray-500">65% de capacidade</div>
        </div>
        <!-- An√°lise do filtro de √≥leo -->
        <div class="bg-white shadow-md rounded-xl p-4 text-center">
          <div class="text-indigo-600 text-xl font-bold mb-2">Filtro da m√°quina</div>
          <p class="text-sm text-gray-700 mb-2">
            Sem ind√≠cios de obstru√ß√£o. Verifica√ß√£o em <strong>300 ciclos</strong>.
          </p>
        </div>
      </div>

      <div class="grid md:grid-cols-2 g4">
        <div class="bg-white shadow-md rounded-xl p-4">
          <canvas id="grafico"></canvas>
        </div>
        <div class="bg-white shadow-md rounded-xl p-4">
          <h2 class="text-xl font-bold mb-2">An√°lise Preditiva com IA</h2>
          <p id="ia-aviso" class="mb-4">
            A IA detectou aumento incomum na Vibra√ß√£o: <strong>Recomenda√ß√£o:</strong> Verificar rolamentos nas pr√≥ximas 12h.
          </p>
          <button id="ia-scan-button" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
            üîç Fazer varredura com IA
          </button>
          <button class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 mt-4">
            üìß Notificar equipe de manuten√ß√£o
          </button>
          <a href="/3d.html"><button id="view-problem-button" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 mt-4">
            üî¥ Ver m√°quina
          </button></a>
        </div>
      </div>
    </div>

    <script>
      const machines = {
        1: { status: "normal", temp: 72, vib: 3.1, press: 5.2, ciclos: 120, oleo: 65, ia: "Verificar rolamentos nas pr√≥ximas 12h." },
        13: { status: "alerta", temp: 75, vib: 3.8, press: 6.0, ciclos: 200, oleo: 45, ia: "Aten√ß√£o: vibra√ß√£o fora do padr√£o. Inspe√ß√£o recomendada." },
        14: { status: "falha", temp: 85, vib: 4.5, press: 7.2, ciclos: 300, oleo: 20, ia: "Falha detectada. M√°quina parada." },
        15: { status: "falha", temp: 88, vib: 4.9, press: 7.5, ciclos: 310, oleo: 15, ia: "Falha grave. Reparo urgente necess√°rio." },
      };

      const machineStandards = { temp: 72, vib: 3.1 };  // Temperatura e vibra√ß√£o padr√£o de uma m√°quina funcionando corretamente.

      const chart = new Chart(document.getElementById('grafico').getContext('2d'), {
        type: 'line',
        data: {
          labels: ['06:00', '08:00', '10:00', '12:00', '14:00', '16:00', '18:00'],
          datasets: [
            {
              label: 'Temperatura',
              data: [70, 71, 72, 72, 73, 74, 75],
              borderColor: '#f59e0b',
              backgroundColor: 'transparent',
              tension: 0.4
            },
            {
              label: 'Vibra√ß√£o',
              data: [2.8, 2.9, 3.0, 3.0, 3.1, 3.1, 3.2],
              borderColor: '#3b82f6',
              backgroundColor: 'transparent',
              tension: 0.4
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            tooltip: { enabled: true },
            legend: { display: true }
          },
          scales: {
            y: { beginAtZero: false }
          }
        }
      });

      function changeMachine(id) {
        id = parseInt(id);
        const data = machines[id] || machines[1];

        // Atualiza t√≠tulo
        document.getElementById('machine-title').innerText = `M√ÅQUINA ${String(id).padStart(2, '0')}`;

        // Atualiza status visual
        const statusEl = document.getElementById('status-container');
        let statusText = "";
        let statusColor = "";

        switch (data.status) {
          case "alerta":
            statusText = "Alerta: Verifica√ß√£o necess√°ria";
            statusColor = "bg-yellow-500";
            break;
          case "falha":
            statusText = "Falha cr√≠tica!";
            statusColor = "bg-red-600";
            break;
          default:
            statusText = "Funcionando normalmente";
            statusColor = "bg-green-500";
        }

        statusEl.innerHTML = `<div class="w-4 h-4 ${statusColor} rounded-full mr-2"></div>
                              <span class="text-lg font-medium">${statusText}</span>`;

        // Atualiza valores
      let temp = data.temp;
        let vib = data.vib;

        // Ajustar temperatura e vibra√ß√£o para os padr√µes da m√°quina
        if (data.status === "normal") {
          temp = machineStandards.temp;
          vib = machineStandards.vib;
        }

        document.getElementById('temp-value').innerText = `${temp}¬∞C`;
        document.getElementById('vibracao-value').innerText = `${vib} mm/s`;
        document.getElementById('pressao-value').innerText = `${data.press.toFixed(1)} bar`;
        document.getElementById('ciclos-value').innerText = data.ciclos;
        document.getElementById('oleo-bar').style.width = `${data.oleo}%`;
        document.getElementById('ia-aviso').innerHTML = `A IA detectou: <strong>${data.ia}</strong>`;
      }

        document.getElementById('ia-scan-button').addEventListener('click', function() {
        const selectedMachine = parseInt(document.getElementById('machine-selector').value);
        const machineData = machines[selectedMachine];

        if (machineData.status === "falha") {
        // A IA detecta a falha grave
        alert("A IA detectou: Falha grave. Reparo urgente necess√°rio.");
        
        // Simula a resolu√ß√£o do problema e a volta ao funcionamento
        //machines[selectedMachine].status = "normal";
        //changeMachine(selectedMachine);
        //alert("Erro no posicionamento da pe√ßa ajustado.");
        } else if (machineData.status === "alerta") {
        // A IA detecta um erro de programa√ß√£o corrigido
        alert("Problema encontrado na programa√ß√£o e corrigido!");
        
        // Simula a corre√ß√£o e retorna ao estado normal
        machines[selectedMachine].status = "normal";
        alert("Varredura completa e nenhum problema encontrado!");
        changeMachine(selectedMachine);
        } else if (machineData.status === "normal") {
        alert("Varredura completa e nenhum problema encontrado!");
        }
    });
    </script>

  </body>
</html>
